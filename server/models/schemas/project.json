{
	"$schema": "http://json-schema.org/schema#",
	"title": "Monitool project schema",
	"type": "object",
	"additionalProperties": false,

	"required": [
		"_id", "type", "name", "begin", "end", "indicators", "dataCollection", "themes",
		"inputEntities", "inputGroups", "logicalFrame", "owners", "dataEntryOperators"
	],

	"properties": {
		"_id":   { "$ref": "#/definitions/uuid" },
		"_rev":  { "$ref": "#/definitions/couchdb-revision" },
		"type":  { "type": "string", "pattern": "^project$" },
		"name":  { "type": "string", "minLength": 1 },
		"begin": { "type": "string", "format": "date" },
		"end":   { "type": "string", "format": "date" },
		
		"themes": {
			"type": "array",
			"uniqueItems": true,
			"items": {
				"$ref": "#/definitions/uuid"
			}
		},

		"indicators": {
			"type": "object",
			"patternProperties": {
				"^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$": {
					"type": "object",
					"additionalProperties": false,
					"required": [
						"relevance", "baseline", "minimum", "orangeMinimum", "greenMinimum",
						"greenMaximum", "orangeMaximum", "maximum", "targets"
					],
					"properties": {
						"relevance":     {"type": "string", "minLength": 1},
						"baseline":      {"type": "number"},
						"minimum":       {"type": "number"},
						"orangeMinimum": {"type": "number"},
						"greenMinimum":  {"type": "number"},
						"greenMaximum":  {"type": "number"},
						"orangeMaximum": {"type": "number"},
						"maximum":       {"type": "number"},

						"targets": {
							"type": "array",
							"items": {
								"type": "object",
								"additionalProperties": false,
								"properties": {
									"period": { "type": "string", "format": "date" },
									"value": { "type": "number" }
								}
							}
						}
					}
				}
			}
		},

		"dataCollection": {
			"type": "array",
			"items": {
				"type": "object",
				"required": ["id", "name", "start", "end", "active", "useProjectStart", "useProjectEnd", "periodicity", "intermediaryDates", "fields"],
				"additionalProperties": false,
				"properties": {
					"id":    { "$ref": "#/definitions/uuid" },
					"name":  { "type": "string", "minLength": 1 },
					"start": { "type": "string", "format": "date" },
					"end":   { "type": "string", "format": "date" },
					
					"active": { "type": "boolean" },
					"useProjectStart": { "type": "boolean" },
					"useProjectEnd": { "type": "boolean" },

					"periodicity": {
						"type": "string",
						"enum": ["day", "week", "month", "quarter", "year", "planned"]
					},

					"intermediaryDates": {
						"type": "array",
						"items": { "type": "string", "format": "date" }
					},
					
					"fields": {
						"type": "array",
						"items": {
							"type": "object",
							"required": ["id", "type"],
							"additionalProperties": false,
							"properties": {
								"id": { "$ref": "#/definitions/uuid" },
								"type": {
									"type": "string",
									"pattern": "^input|(link:[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}(\\.[a-z0-9A-Z]+)+)|(compute:[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})$"
								},
								"source": {
									"type": "string"
								},
								"parameters": {
									"type": "object",
									"additionalProperties": {
										"^[a-z0-9A-Z]+$": {
											"$ref": "#/properties/dataCollection/items/properties/inputEntities"
										}
									}
								}
							}
						}
					}
				}
			}
		},
		
		"inputEntities": {
			"type": "array",
			"items": {
				"id":   { "$ref": "#/definitions/uuid" },
				"name": { "type": "string", "minLength": 1 }	
			}
		},

		"inputGroups": {
			"type": "array",
			"items": {
				"type": "object",
				"properties": {
					"id":      { "$ref": "#/definitions/uuid" },
					"name":    { "type": "string", "minLength": 1 },
					"members": { "type": "array", "items": { "$ref": "#/definitions/uuid" }}
				}
			}
		},

		"logicalFrame": {
			"type": "object",
			"additionalProperties": false,
			"properties": {
				"goal": { "type": "string", "minLength": 1 },
				"purposes": {
					"type": "array",
					"items": {
						"type": "object",
						"additionalProperties": false,
						"properties": {
							"description": { "type": "string", "minLength": 1 },
							"assumptions": { "type": "string", "minLength": 1 },
							"outputs": {
								"type": "array",
								"items": {
									"type": "object",
									"additionalProperties": false,
									"properties": {
										"description": { "type": "string", "minLength": 1 },
										"assumptions": { "type": "string", "minLength": 1 },
										"activities": {
											"type": "array",
											"items": {
												"type": "object",
												"additionalProperties": false,
												"required": ["description", "prerequisites"],

												"properties": {
													"description": { "type": "string", "minLength": 1 },
													"prerequisites": { "type": "string", "minLength": 1 }
												}
											}
										},
										"indicators": { "type": "array", "items": { "$ref": "#/definitions/uuid" }}
									}
								}
							},
							"indicators": { "type": "array", "items": { "$ref": "#/definitions/uuid" }}
						}
					}
				},
				"indicators": { "type": "array", "items": { "$ref": "#/definitions/uuid" }}
			}
		},

		"owners":             { "$ref": "#/definitions/user-list" },
		"dataEntryOperators": { "$ref": "#/definitions/user-list" }
	},

	"definitions": {
		"uuid": {
			"type": "string",
			"pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
		},
		"couchdb-revision": {
			"type": "string",
			"pattern": "^[0-9]+\\-[0-9a-f]{32}$"
		},
		"user-list": {

		}
	}
}
