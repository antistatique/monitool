<div class="row">
	<div class="col-md-2">
		<ng-include src="'partials/projects/menu.html'"></ng-include>
	</div>

	<div class="col-md-10">

		<ol class="breadcrumb">
			<li><a href="#projects">Projets</a></li>
			<li><a href="#projects/{{project._id}}">{{project.name}}</a></li>
			<li><a href="#projects/{{project._id}}/forms">Formulaires de saisie</a></li>
			<li class="active">{{form.name}}</li>
		</ol>

		<form class="form-horizontal" role="form" name="formForm" novalidate>

			<fieldset>
				<legend>Collecte</legend>

				<div class="form-group" show-errors>
					<label for="input-name" class="col-sm-2 control-label">Nom</label>
					<div class="col-sm-10">
						<input type="text"
							   class="form-control"
							   id="input-name"
							   name="name"
							   ng-model="form.name"
							   placeholder="Exemple: Sondage trimestriel"
							   required />
						
						<p class="help-block" ng-if="formForm.name.$error.required">
							Ce champ est obligatoire
						</p>
					</div>
				</div>

				<div class="form-group" show-errors>
					<label for="periodicity-input" class="col-sm-2 control-label">Périodicité</label>
					<div class="col-sm-10">
						<select class="form-control"
								name="periodicity"
								id="periodicity-input"
								ng-model="form.periodicity">
							<option value="monthly">Tous les mois</option>
							<option value="planned">Planifiée</option>
						</select>
					</div>
				</div>

				<div ng-if="form.periodicity == 'monthly'">
					<div class="form-group" show-errors>
						<label for="periodicity" class="col-sm-2 control-label">Début</label>
						<div class="col-sm-10">
							<div class="input-group">
								<div class="input-group-addon">
									<input type="checkbox" ng-model="form.useProjectStart" /> Début du projet
								</div>

								<input type="month"
									   class="form-control"
									   ng-model="form.start"
									   ng-disabled="form.useProjectStart"
									   name="start"
									   required />
							</div>
						</div>
					</div>

					<div class="form-group" show-errors>
						<label for="periodicity" class="col-sm-2 control-label">Fin</label>
						<div class="col-sm-10">
							<div class="input-group">
								<div class="input-group-addon">
									<input type="checkbox" ng-model="form.useProjectEnd" /> Fin du projet
								</div>

								<input type="month"
									   class="form-control"
									   ng-model="form.end"
									   ng-disabled="form.useProjectEnd"
									   name="end"
									   required />
							</div>
						</div>
					</div>
				</div>
			</fieldset>

			<fieldset>
				<legend>Indicateurs</legend>
				
				<table class="table table-bordered table-stripped">
					<tr ng-repeat="indicator in chosenIndicators">
						<td>
							<input type="checkbox" ng-disabled="indicator.disabled" ng-model="indicator.selected" ng-change="updateFields()" />
						</td>
						<td>{{indicatorsById[indicator.id].name}}</td>
					</tr>
				</table>
			</fieldset>

			<fieldset>
				<legend>Formulaire de saisie</legend>
				
				<table class="table table-bordered table-stripped">
					<thead>
						<tr>
							<th>Sommable</th>
							<th>Champ de saisie</th>
							<th>Source de la valeur</th>
							<th>Mode de saisie</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="(indicatorId, field) in form.fields" ng-if="field.type == 'manual'">
							<td>
								<i class="fa fa-check" style="color: green" ng-show="indicatorsById[indicatorId].sumAllowed"></i>
								<i class="fa fa-times" style="color: red" ng-hide="indicatorsById[indicatorId].sumAllowed"></i>
							</td>
							<td>{{indicatorsById[indicatorId].name}}</td>
							<td><div contenteditable ng-model="field.source"></div></td>
							<td>
								<div class="btn-group">
									<button class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
										Saisie manuelle
										<span class="caret"></span>
									</button>
									<ul class="dropdown-menu" role="menu">
										<li ng-repeat="(formulaId, formula) in indicatorsById[indicatorId].formulas">
											<a ng-click="useFormula(indicatorId, formulaId)">{{formula.name}}</a>
										</td>
									</ul>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</fieldset>
		</form>
	</div>
</div>

