<div class="modal-body">
	<form class="form-horizontal" role="form" name="planningForm" novalidate>
		<legend ng-bind="indicator.name[language]"></legend>

		<div class="well well-sm">
			<div class="form-group" show-errors>
				<label for="relevance-input" class="col-sm-2 control-label" translate="project.relevance"></label>
				<div class="col-sm-10" acl-has-project-role="owner" acl-fallback="planning.relevance">
					<textarea class="form-control"
							  id="relevance-input"
							  name="relevance"
							  ng-model="planning.relevance"
							  placeholder="{{'project.relevance_ph'|translate}}"
							  required></textarea>

					<p class="help-block" ng-if="planningForm.relevance.$error.required" translate="form.mandatory"></p>
				</div>
			</div>

			<div class="form-group" show-errors>
				<label for="source-input" class="col-sm-2 control-label" translate="project.source"></label>
				<div class="col-sm-10" acl-has-project-role="owner" acl-fallback="planning.source">
					<input class="form-control" id="source-input" name="source" ng-model="planning.source" placeholder="{{'project.source_ph'|translate}}" required />
					<p class="help-block" ng-if="planningForm.source.$error.required" translate="form.mandatory"></p>
				</div>
			</div>

			<div class="form-group" show-errors>
				<label for="in-charge-input" class="col-sm-2 control-label" translate="project.in_charge"></label>
				<div class="col-sm-10" acl-has-project-role="owner" acl-fallback="planning.inCharge">
					<input class="form-control" id="in-charge-input" name="inCharge" ng-model="planning.inCharge" placeholder="{{'project.in_charge_ph'|translate}}" required />
					<p class="help-block" ng-if="planningForm.inCharge.$error.required" translate="form.mandatory"></p>
				</div>
			</div>
		</div>

		<div class="well well-sm" acl-has-project-role="owner">
			<div class="form-group">
				<label for="formula-input" class="col-sm-2 control-label" translate="indicator.formula"></label>
				<div class="col-sm-10">
					<select class="form-control" name="planning-formula" ng-model="planning.formula" ng-options="id as formula.expression for (id, formula) in indicator.formulas">
						<option value="" translate="shared.none"></option>
					</select>
				</div>
			</div>

			<div class="form-group" ng-if="!planning.formula">
				<label for="source2-input" class="col-sm-2 control-label" translate="project.variable"></label>
				<div class="col-sm-10">
					<project-activity-variable project="project" planning="planning"></project-activity-variable>
				</div>
			</div>

			<div class="form-group" ng-if="planning.variable">
				<label for="source2-input" class="col-sm-2 control-label" translate="shared.filter"></label>
				<div class="col-sm-10">
					<project-activity-filter project="project" planning="planning"></project-activity-filter>
				</div>
			</div>

			<table class="table table-bordered table-condensed" ng-if="planning.formula" style="background-color: white">
				<thead>
					<tr>
						<th>Nom</th>
						<th>Variable</th>
						<th>Filtre</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="(paramKey, value) in planning.parameters">
						<td ng-bind="indicator.formulas[planning.formula].parameters[paramKey][language]"></td>
						<td>
							<project-activity-variable project="project" planning="value"></project-activity-variable>
						</td>
						<td style="padding: 0">
							<project-activity-filter project="project" planning="value"></project-activity-filter>
						</td>
					<tr>
				</tbody>
			</table>
		</div>

		<div class="well well-sm">

			<div class="form-group">
				<label for="colorize-input" class="col-sm-2 control-label" translate="shared.colorize"></label>
				<div class="col-sm-10" acl-has-project-role="owner" acl-fallback="planning.colorize">
					<input id="colorize-input" type="checkbox" ng-model="planning.colorize" />
				</div>
			</div>

			<div class="form-group" show-errors>
				<label for="baseline-input" class="col-sm-2 control-label" translate="project.baseline"></label>
				<div class="col-sm-10" acl-has-project-role="owner" acl-fallback="planning.baseline">
					<div class="input-group">
						<span class="input-group-addon">
							<input type="checkbox" ng-model="baselineUnknown" id="baseline_unknown_input">
							<label for="baseline_unknown_input" style="font-weight: normal" translate="project.unknown"></label>
						</span>

						<input class="form-control"
							   id="baseline-input"
							   name="baseline"
							   type="number"
							   ng-model="planning.baseline"
							   ng-disabled="baselineUnknown"
							   placeholder="{{'project.baseline_ph'|translate}}"
							   ng-required="!baselineUnknown" />
					</div>
				</div>
			</div>

			<div class="form-group" show-errors>
				<label for="target-input" class="col-sm-2 control-label" translate="project.target"></label>
				<div class="col-sm-10" acl-has-project-role="owner" acl-fallback="planning.target">
					<div class="input-group">
						<span class="input-group-addon">
							<input type="checkbox" ng-model="targetUnknown" id="target_unknown_input">
							<label for="target_unknown_input" style="font-weight: normal" translate="project.unknown"></label>
						</span>

						<input id="target-input"
							   class="form-control"
							   type="number"
							   name="target"
							   ng-model="planning.target"
							   ng-disabled="targetUnknown"
							   placeholder="{{'project.target_ph'|translate}}"
							   ng-required="!targetUnknown" />
					</div>
				</div>
			</div>
		</div>
	</form>
</div>

<div class="modal-footer">
	<button ng-click="save()" ng-disabled="planningForm.$invalid || isUnchanged()" class="btn btn-primary" ng-if="isNew" acl-has-project-role="owner">
		<i class="fa fa-plus"></i>
		<span translate="shared.add"></span>
	</button>

	<button ng-click="save()" ng-disabled="planningForm.$invalid || isUnchanged()" class="btn btn-primary" ng-if="!isNew" acl-has-project-role="owner">
		<i class="fa fa-floppy-o"></i>
		<span translate="shared.edit"></span>
	</button>

	<button ng-click="detach()" class="btn btn-default" ng-if="!isNew && isDetachable" acl-has-project-role="owner">
		<i class="fa fa-arrow-down"></i>
		<span translate="shared.detach"></span>
	</button>

	<button ng-click="delete()" class="btn btn-danger" ng-if="!isNew" acl-has-project-role="owner">
		<i class="fa fa-remove"></i>
		<span translate="shared.delete"></span>
	</button>

	<button ng-click="cancel()" class="btn btn-default">
		<i class="fa fa-undo"></i>
		<span translate="shared.cancel"></span>
	</button>
</div>
